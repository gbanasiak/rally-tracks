{
  "name": "delete-index",
  "operation": {
    "operation-type": "delete-index"
  }
},
{
  "name": "create-index",
  "operation": {
    "operation-type": "create-index",
    "settings": {%- if index_settings is defined %} {{index_settings | tojson}} {%- else %} {
      {# non-serverless-index-settings-marker-start #}{%- if build_flavor != "serverless" or serverless_operator == true -%}
        {% if p_include_non_serverless_index_settings %}
      "index.store.type": "{{store_type | default('fs')}}",
        {% endif %}
      {%- endif -%}{# non-serverless-index-settings-marker-end #}
      "index.codec": "best_compression"
    }{%- endif %}
  }
},
{
  "name": "check-cluster-health",
  "operation": {
    "operation-type": "cluster-health",
    "index": "nyc_taxis",
    "request-params": {
      "wait_for_status": "{{cluster_health | default('green')}}"
    },
    "retry-until-success": true
  }
}
{%- set p_as_clients = (as_clients | default([]))%}
{%- set p_as_ingest_percentages = (as_ingest_percentages | default([]))%}
{%- set p_as_target_throughputs = (as_target_throughputs | default([]))%}
{%- set p_as_labels = (as_labels | default([]))%}
{%- set p_bulk_size = (bulk_size | default(10000))%}
{%- for i in range(as_clients|length) %},
  {%- if p_as_target_throughputs[i] < 0 %}
{
  "name": "bulk-{{loop.index}}-{{p_as_clients[i]}}clients-{{p_as_labels[i]}}",
  "clients": {{p_as_clients[i]}},
  "ignore-response-error-level": "{{error_level | default('non-fatal')}}",
  "operation": {
    "operation-type": "bulk",
    "bulk-size": {{p_bulk_size}},
    "ingest-percentage": {{p_as_ingest_percentages[i]}}
  }
}
  {%- else %}
{
  "name": "bulk-{{loop.index}}-{{p_as_clients[i]}}clients-throughput{{(p_as_target_throughputs[i]*p_bulk_size/1000)|int}}k-{{p_as_labels[i]}}",
  "clients": {{p_as_clients[i]}},
  "ignore-response-error-level": "{{error_level | default('non-fatal')}}",
  "operation": {
    "operation-type": "bulk",
    "bulk-size": {{p_bulk_size}},
    "ingest-percentage": {{p_as_ingest_percentages[i]}},
    "target-throughput": {{p_as_target_throughputs[i]}}
  }
}
  {%- endif %}
{%- endfor %}
